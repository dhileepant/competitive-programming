import sys
input=sys.stdin.readline

t=int(input())
while t:
    
    n=int(input())
    a=[0]*(n+1)
    p=[0]*(n+1)
    v=list(map(int,input().split()))
    for i in range(1,n+1):
        a[i]=v[i-1]
        p[i]=p[i-1]+a[i]

    s=p[n]
    b=-10**30
    m=-10**30
    
    t-=1
    
    for r in range(1,n+1):
        x=r-r*r+p[r-1]
        m=max(m,x)
        y=r*(r+1)-p[r]
        z=y+m
        b=max(b,z)

    if b<0:
        b=0
        
    ans  = s+b
    
    print(ans)
